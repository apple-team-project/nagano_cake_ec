<h2>注文履歴詳細</h2>

<table>
  <tr>
    <th>購入者</th>
    <td><%= @order.customer.full_name %></td>
  </tr>
  <tr>
    <th>注文日</th>
    <td><%= @order.created_at.strftime('%Y-%m-%d') %></td>
  </tr>
  <tr>
    <th>注文ステータス</th>
    <td>
      <%= form_with(model: @order, url: admin_order_path(@order), method: :patch, local: true) do |f| %>
        <%= f.select :status, Order.statuses.keys.map { |status| [status.humanize, status] }, { selected: @order.status } %>
        <%= f.submit '更新' %>
      <% end %>
    </td>
  </tr>
</table>

<table>
  <thead>
    <tr>
      <th>商品名</th>
      <th>単価（税込）</th>
      <th>数量</th>
      <th>制作ステータス</th>
    </tr>
  </thead>
  <tbody>
    <% @order_details.each do |detail| %>
      <tr>
        <td><%= detail.item.name %></td>
        <td><%= number_to_currency(detail.price, unit: "¥") %></td>
        <td><%= detail.amount %></td>
        <td>
          <%= form_with model: detail, url: admin_order_detail_path(detail), local: true, method: :patch do |f| %>
            <%= f.select :status, OrderDetail.statuses.keys.map { |s| [s.humanize, s] }, {}, class: "form-control" %>
            <%= f.submit "更新", class: "btn btn-primary" %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<div>
  <p>商品合計: <%= number_to_currency(@order.total_payment, unit: "¥") %></p>
  <p>送料: <%= number_to_currency(@order.shipping_fee, unit: "¥") %></p>
  <p>請求金額合計: <%= number_to_currency(@order.total_price, unit: "¥") %></p>
</div>
